<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gopalsing Query Handling System</title>
<link rel="icon" type="image/x-icon" href="https://png.pngtree.com/png-clipart/20211116/original/pngtree-letter-g-logo-design-vector-png-png-image_6946247.png">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .card-query{cursor:default}
    .status-badge.open{background:#f8d7da;color:#842029}
    .status-badge.inprogress{background:#fff3cd;color:#664d03}
    .status-badge.resolved{background:#d1e7dd;color:#0f5132}
    .small-muted{font-size:0.85rem;color:#6c757d}
    .sidebar{max-height:80vh;overflow:auto}
  </style>
</head>
<body class="bg-light">
  <nav class="navbar navbar-expand-lg navbar-white bg-white shadow-sm mb-4">
    <div class="container">
      <a class="navbar-brand fw-bold" href="#">Gopalsing Query Handling</a>
      <div class="small text-muted d-none d-md-block">Created‚úèÔ∏èBy Dr.Gopalsing Giraseüíª</div>
    </div>
  </nav>

<style>
body {
  background-image: url("https://www.webstrategyplus.com/wp-content/uploads/2017/07/Depositphotos_7354494_m-2015.jpg");
}
</style>

  <div class="container">
    <div class="row">
      <!-- Left: New query form & filters -->
      <aside class="col-lg-4 mb-4 sidebar">
        <div class="card shadow-sm mb-3">
          <div class="card-body">
            <h5 class="card-title">New Query</h5>
            <form id="queryForm">
              <div class="mb-2">
                <label class="form-label">Name</label>
                <input id="qName" class="form-control" required />
              </div>
              <div class="mb-2">
                <label class="form-label">Email</label>
                <input id="qEmail" class="form-control" type="email" required />
              </div>
              <div class="mb-2">
                <label class="form-label">Subject</label>
                <input id="qSubject" class="form-control" required />
              </div>
              <div class="mb-2">
                <label class="form-label">Message</label>
                <textarea id="qMessage" class="form-control" rows="4" required></textarea>
              </div>
              <div class="d-grid">
                <button class="btn btn-primary" type="submit">Submit Query</button>
              </div>
            </form>
          </div>
        </div>

        <div class="card shadow-sm">
          <div class="card-body">
            <h6>Filters</h6>
            <div class="mb-2">
              <input id="searchInput" class="form-control" placeholder="Search by name, email, subject" />
            </div>
            <div class="mb-2">
              <select id="statusFilter" class="form-select">
                <option value="all">All statuses</option>
                <option value="open">Open</option>
                <option value="inprogress">In Progress</option>
                <option value="resolved">Resolved</option>
              </select>
            </div>
            <div class="d-grid">
              <button id="clearFilters" class="btn btn-outline-secondary">Clear filters</button>
            </div>
            <hr>
            <div class="small text-muted">Data is stored in your browser (localStorage). Use export/import to backup or move data.</div>
            <div class="mt-2 d-flex gap-2">
              <button id="exportBtn" class="btn btn-sm btn-outline-primary">Export JSON</button>
              <button id="importBtn" class="btn btn-sm btn-outline-secondary">Import JSON</button>
              <input type="file" id="importFile" accept="application/json" style="display:none" />
            </div>
          </div>
        </div>
      </aside>

      <!-- Right: Query list -->
      <main class="col-lg-8">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="mb-0">Queries</h5>
          <div class="small text-muted">Manage, reply, assign, and export</div>
        </div>

        <div id="queryList" class="row g-3">
          <!-- query cards appear here -->
        </div>

        <div class="mt-3">
          <pre id="debug" class="p-3 bg-white border rounded" style="max-height:200px;overflow:auto;display:none"></pre>
        </div>
      </main>
    </div>
  </div>

  <!-- Reply / Edit Modal -->
  <div class="modal fade" id="replyModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Query Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div id="modalContent"></div>
          <hr>
          <div>
            <label class="form-label">Add reply</label>
            <textarea id="replyText" class="form-control" rows="3"></textarea>
            <div class="mt-2 d-flex gap-2">
              <button id="sendReplyBtn" class="btn btn-primary">Send & Save</button>
              <button id="markResolvedBtn" class="btn btn-outline-success">Mark Resolved</button>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Simple client-side Query Handling System
    const STORAGE_KEY = 'qsys_queries_v1';
    let queries = []; // {id,name,email,subject,message,status,assigned,replies: [{text,at,by}] ,created}
    let activeQueryId = null;

    // Helpers
    function uid(){return Math.random().toString(36).slice(2,9)}
    function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(queries)); }
    function load(){ const raw = localStorage.getItem(STORAGE_KEY); queries = raw?JSON.parse(raw):[]; }

    // render list
    function renderList(){
      const container = document.getElementById('queryList'); container.innerHTML='';
      const search = document.getElementById('searchInput').value.trim().toLowerCase();
      const statusFilter = document.getElementById('statusFilter').value;
      const filtered = queries.filter(q=>{
        if(statusFilter!=='all' && q.status!==statusFilter) return false;
        if(!search) return true;
        return (q.name+q.email+q.subject+q.message).toLowerCase().includes(search);
      });
      if(filtered.length===0){ container.innerHTML='<div class="col-12"><div class="alert alert-info">No queries found.</div></div>'; return; }

      for(const q of filtered){
        const col = document.createElement('div'); col.className='col-12';
        const card = document.createElement('div'); card.className='card card-query shadow-sm';
        const body = document.createElement('div'); body.className='card-body d-flex gap-3 align-items-start';
        body.innerHTML = `
          <div style="width:48px;height:48px;border-radius:8px;background:#eef2ff;display:flex;align-items:center;justify-content:center;font-weight:700">${q.name.split(' ').map(s=>s[0]).slice(0,2).join('')}</div>
          <div class="flex-grow-1">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <h6 class="mb-0">${escapeHtml(q.subject)}</h6>
                <div class="small-muted">${escapeHtml(q.name)} ‚Ä¢ ${escapeHtml(q.email)}</div>
              </div>
              <div class="text-end">
                <div><span class="badge status-badge ${q.status}">${capitalize(q.status)}</span></div>
                <div class="small-muted">${new Date(q.created).toLocaleString()}</div>
              </div>
            </div>
            <p class="mt-2 mb-2">${escapeHtml(q.message)}</p>
            <div class="d-flex gap-2">
              <button class="btn btn-sm btn-outline-primary" data-action="view" data-id="${q.id}">View</button>
              <button class="btn btn-sm btn-outline-secondary" data-action="assign" data-id="${q.id}">Assign</button>
              <button class="btn btn-sm btn-outline-danger" data-action="delete" data-id="${q.id}">Delete</button>
            </div>
            <div class="mt-2 small text-muted">Assigned: ${q.assigned||'‚Äî'} ‚Ä¢ Replies: ${q.replies.length}</div>
          </div>`;
        card.appendChild(body); col.appendChild(card); container.appendChild(col);
      }
    }

    // escape helper
    function escapeHtml(s){ return (s+'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
    function capitalize(s){ return s.charAt(0).toUpperCase()+s.slice(1); }

    // init
    load(); renderList();

    // form submit
    document.getElementById('queryForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const name=document.getElementById('qName').value.trim();
      const email=document.getElementById('qEmail').value.trim();
      const subject=document.getElementById('qSubject').value.trim();
      const message=document.getElementById('qMessage').value.trim();
      const q={id:uid(),name,email,subject,message,status:'open',assigned:'',replies:[],created:Date.now()};
      queries.unshift(q); save(); renderList(); e.target.reset();
    });

    // list actions (view, assign, delete)
    document.getElementById('queryList').addEventListener('click', (e)=>{
      const action = e.target.getAttribute('data-action');
      const id = e.target.getAttribute('data-id');
      if(!action) return;
      const q = queries.find(x=>x.id===id); if(!q) return;
      if(action==='view') openModal(q.id);
      if(action==='assign'){
        const who = prompt('Assign to (team member)', q.assigned||''); if(who===null) return; q.assigned=who; save(); renderList(); }
      if(action==='delete'){
        if(!confirm('Delete query permanently?')) return; queries = queries.filter(x=>x.id!==id); save(); renderList(); }
    });

    // open modal
    const replyModalEl = document.getElementById('replyModal'); const replyModal = new bootstrap.Modal(replyModalEl);
    function openModal(id){
      activeQueryId = id; const q = queries.find(x=>x.id===id); if(!q) return;
      const container = document.getElementById('modalContent');
      container.innerHTML = `
        <div><strong>Subject:</strong> ${escapeHtml(q.subject)}</div>
        <div class="small-muted">From: ${escapeHtml(q.name)} ‚Ä¢ ${escapeHtml(q.email)}</div>
        <div class="mt-2"><strong>Message</strong><p>${escapeHtml(q.message)}</p></div>
        <hr>
        <div><strong>Replies</strong></div>
        <div id="repliesArea">${q.replies.map(r=>`<div class="border rounded p-2 mb-2"><div class="small-muted">${new Date(r.at).toLocaleString()} ‚Ä¢ ${escapeHtml(r.by||'You')}</div><div>${escapeHtml(r.text)}</div></div>`).join('') || '<div class="text-muted small">No replies yet.</div>'}</div>
      `;
      document.getElementById('replyText').value=''; replyModal.show();
    }

    // send reply
    document.getElementById('sendReplyBtn').addEventListener('click', ()=>{
      const text = document.getElementById('replyText').value.trim(); if(!text) return alert('Reply cannot be empty');
      const q = queries.find(x=>x.id===activeQueryId); if(!q) return;
      q.replies.push({text,at:Date.now(),by:'Support'}); q.status = 'inprogress'; save(); renderList(); openModal(q.id);
      // In real app: send email/notification here
    });

    // mark resolved
    document.getElementById('markResolvedBtn').addEventListener('click', ()=>{
      const q = queries.find(x=>x.id===activeQueryId); if(!q) return; q.status='resolved'; save(); renderList(); openModal(q.id);
    });

    // filters
    document.getElementById('searchInput').addEventListener('input', renderList);
    document.getElementById('statusFilter').addEventListener('change', renderList);
    document.getElementById('clearFilters').addEventListener('click', ()=>{ document.getElementById('searchInput').value=''; document.getElementById('statusFilter').value='all'; renderList(); });

    // export / import
    document.getElementById('exportBtn').addEventListener('click', ()=>{
      const blob = new Blob([JSON.stringify(queries,null,2)],{type:'application/json'});
      const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url; a.download='queries.json'; a.click(); URL.revokeObjectURL(url);
    });
    document.getElementById('importBtn').addEventListener('click', ()=>{ document.getElementById('importFile').click(); });
    document.getElementById('importFile').addEventListener('change', async (e)=>{
      const f = e.target.files[0]; if(!f) return; const text = await f.text(); try{ const data = JSON.parse(text); if(!Array.isArray(data)) throw 0; queries = data; save(); renderList(); alert('Imported successfully'); } catch(err){ alert('Invalid JSON file'); } e.target.value=''; });

    // debug helper (toggle with Ctrl+D)
    window.addEventListener('keydown', (e)=>{ if(e.ctrlKey && e.key.toLowerCase()==='d'){ const dbg = document.getElementById('debug'); dbg.style.display = dbg.style.display==='none'?'block':'none'; dbg.textContent = JSON.stringify(queries,null,2); } });

  </script>
</body>
</html>